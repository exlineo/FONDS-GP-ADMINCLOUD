{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport { UtilsService } from '../systeme/library/utils.service';\nimport { FiltresService } from '../systeme/services/filtres.service';\nimport { Filtre } from '../systeme/modeles/filtre.modele';\nimport { Set } from '../systeme/modeles/set';\nimport { environment } from '../../../environments/environment';\nimport { CloudGetService } from '../systeme/services/cloud-get.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../systeme/services/filtres.service\";\nimport * as i2 from \"../systeme/library/utils.service\";\nimport * as i3 from \"../systeme/services/cloud-get.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/expansion\";\nimport * as i6 from \"@angular/material/progress-spinner\";\nimport * as i7 from \"@angular/forms\";\n\nfunction ScannerComponent_li_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\", 13);\n    i0.ɵɵlistener(\"click\", function ScannerComponent_li_13_Template_li_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const d_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.scanOnClick(d_r6));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const d_r6 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", d_r6, \" \");\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\")(1, \"strong\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const m_r11 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(m_r11.key);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" : \", m_r11.value, \" \");\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\")(1, \"strong\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const l_r17 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(l_r17.key);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" : \", l_r17.value, \" \");\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_ng_template_2_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\")(1, \"strong\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const k_r23 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(k_r23.key);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" : \", k_r23.value, \" \");\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"strong\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"ul\");\n    i0.ɵɵtemplate(3, ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_ng_template_2_li_3_Template, 4, 2, \"li\", 2);\n    i0.ɵɵpipe(4, \"keyvalue\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const l_r17 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(l_r17.key);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(4, 2, l_r17.value));\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtemplate(1, ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_span_1_Template, 4, 2, \"span\", 14);\n    i0.ɵɵtemplate(2, ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_ng_template_2_Template, 5, 4, \"ng-template\", null, 16, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const l_r17 = ctx.$implicit;\n\n    const _r19 = i0.ɵɵreference(3);\n\n    const ctx_r16 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r16.utils.typeOf(l_r17.value) !== \"object\")(\"ngIfElse\", _r19);\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"strong\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"ul\");\n    i0.ɵɵtemplate(3, ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_li_3_Template, 4, 2, \"li\", 2);\n    i0.ɵɵpipe(4, \"keyvalue\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const m_r11 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(m_r11.key);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(4, 2, m_r11.value));\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_li_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtemplate(1, ScannerComponent_mat_expansion_panel_23_li_5_span_1_Template, 4, 2, \"span\", 14);\n    i0.ɵɵtemplate(2, ScannerComponent_mat_expansion_panel_23_li_5_ng_template_2_Template, 5, 4, \"ng-template\", null, 15, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const m_r11 = ctx.$implicit;\n\n    const _r13 = i0.ɵɵreference(3);\n\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.utils.typeOf(m_r11.value) !== \"object\")(\"ngIfElse\", _r13);\n  }\n}\n\nfunction ScannerComponent_mat_expansion_panel_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-expansion-panel\")(1, \"mat-expansion-panel-header\")(2, \"mat-panel-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ul\");\n    i0.ɵɵtemplate(5, ScannerComponent_mat_expansion_panel_23_li_5_Template, 4, 2, \"li\", 2);\n    i0.ɵɵpipe(6, \"keyvalue\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const s_r9 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" \", s_r9[\"title\"], \" (\", s_r9[\"id\"], \") \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(6, 3, s_r9));\n  }\n}\n\nfunction ScannerComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ScannerComponent_div_26_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r26 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r26.pagine(-20));\n    });\n    i0.ɵɵtext(2, \" < \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ScannerComponent_div_26_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r28 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r28.pagine(20));\n    });\n    i0.ɵɵtext(4, \">\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.page.min < 20);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r2.page.max > ctx_r2.cloud.scannedData.length - 20);\n  }\n}\n\nfunction ScannerComponent_ul_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\")(1, \"li\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"li\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"li\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"li\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Titre : \", ctx_r4.cloud.collection.title, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Alias : \", ctx_r4.cloud.collection.alias, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Set : \", ctx_r4.cloud.collection.set, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Fonds : \", ctx_r4.cloud.collection.funds, \"\");\n  }\n}\n\nfunction ScannerComponent_section_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"section\", 19)(1, \"article\")(2, \"h2\");\n    i0.ɵɵtext(3, \"Scan des donn\\u00E9es\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"mat-progress-spinner\", 20);\n    i0.ɵɵelementEnd()();\n  }\n}\n\nexport let ScannerComponent = /*#__PURE__*/(() => {\n  class ScannerComponent {\n    constructor(filtresServ, utils, cloud) {\n      this.filtresServ = filtresServ;\n      this.utils = utils;\n      this.cloud = cloud;\n    }\n\n    ngOnInit() {\n      this.set = new Set();\n      this.set.date = Date.now();\n      this.filtreChoisi = new Filtre();\n      this.page = {\n        min: 0,\n        max: 20\n      }; // Get folders on Cloud\n\n      this.cloud.getFolders();\n    }\n    /**\n     * Accéder aux notices d'une scan\n     * @param dossier Dossier scanné pour afficher la liste des notices\n     */\n\n\n    scanOnClick(dossier) {\n      // Modification des données du SET initial\n      this.set.titre = dossier; // Attribuer un titre par défaut au Set\n\n      this.set.alias = dossier.toLowerCase(); // Proposer un alias par défaut\n\n      this.set.origine = {\n        dir: environment.DIR + dossier,\n        url: environment.SERV\n      }; // Intégrer le nom du dossier scanné dans les données du SET\n      // this.scanServ.getDir(dossier);\n\n      this.cloud.scanFolder(dossier);\n    }\n    /**\n     * FIltre choisi depuis la liste déroulante\n     */\n\n\n    choixFiltre() {\n      this.filtreChoisi = this.filtresServ.filtres.find(f => f._id == this._idFiltre);\n      console.log(this.filtreChoisi);\n    }\n    /**\n     * Pagination des données scannées\n     * @param n Nombre à faire évoluer pour la pagination\n     */\n\n\n    pagine(n) {\n      this.page.min += n;\n      this.page.max += n;\n      console.log(this.page);\n    }\n    /**\n     * Supprimer les scans sélectionnés initialement\n     */\n\n\n    ngOnDestroy() {\n      this.cloud.init();\n    }\n\n  }\n\n  ScannerComponent.ɵfac = function ScannerComponent_Factory(t) {\n    return new (t || ScannerComponent)(i0.ɵɵdirectiveInject(i1.FiltresService), i0.ɵɵdirectiveInject(i2.UtilsService), i0.ɵɵdirectiveInject(i3.CloudGetService));\n  };\n\n  ScannerComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ScannerComponent,\n    selectors: [[\"app-scanner\"]],\n    inputs: {\n      load: \"load\"\n    },\n    decls: 47,\n    vars: 12,\n    consts: [[1, \"screen\", \"triple\"], [3, \"click\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"flex justify-center\", 4, \"ngIf\"], [3, \"ngSubmit\"], [\"setfiltre\", \"ngForm\"], [4, \"ngIf\"], [\"for\", \"description\"], [\"name\", \"description\", \"placeholder\", \"Donnez des informations g\\u00E9n\\u00E9rales sur la collection\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"creator\"], [\"name\", \"creatr\", \"placeholder\", \"Nom de la ou des personne(s)\", 3, \"ngModel\", \"ngModelChange\"], [3, \"disabled\"], [\"class\", \"pop-up\", 4, \"ngIf\"], [3, \"click\"], [4, \"ngIf\", \"ngIfElse\"], [\"elseObjM\", \"\"], [\"elseBlockL\", \"\"], [1, \"flex\", \"justify-center\"], [3, \"disabled\", \"click\"], [1, \"pop-up\"], [\"mode\", \"indeterminate\"]],\n    template: function ScannerComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0)(1, \"aside\")(2, \"header\")(3, \"h1\");\n        i0.ɵɵtext(4, \"Sets de donn\\u00E9es\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"h2\");\n        i0.ɵɵtext(6, \"Liste des dossiers de votre serveur\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"hr\");\n        i0.ɵɵelementStart(8, \"p\");\n        i0.ɵɵtext(9, \"Cette page vous permet de moissonner les donn\\u00E9es dans les m\\u00E9dias depuis le serveur pour constituer ou mettre \\u00E0 jour des collections. C'est le seul moyen de mettre \\u00E0 jour les donn\\u00E9es h\\u00E9berg\\u00E9es dans les notices et les notices rattach\\u00E9es aux collections.\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"p\");\n        i0.ɵɵtext(11, \"En cliquant sur un dossier vous pourrez afficher les m\\u00E9tadonn\\u00E9es des fichiers qu'il contient.\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(12, \"ul\");\n        i0.ɵɵtemplate(13, ScannerComponent_li_13_Template, 2, 1, \"li\", 1);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(14, \"section\")(15, \"header\")(16, \"h2\");\n        i0.ɵɵtext(17, \"M\\u00E9tadonn\\u00E9es\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"hr\");\n        i0.ɵɵelementStart(19, \"p\");\n        i0.ɵɵtext(20, \"Liste des m\\u00E9tadonn\\u00E9es scann\\u00E9es dans le dossier s\\u00E9lectionn\\u00E9 sur le serveur.\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(21, \"hr\");\n        i0.ɵɵelementStart(22, \"mat-accordion\");\n        i0.ɵɵtemplate(23, ScannerComponent_mat_expansion_panel_23_Template, 7, 5, \"mat-expansion-panel\", 2);\n        i0.ɵɵpipe(24, \"slice\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(25, \"hr\");\n        i0.ɵɵtemplate(26, ScannerComponent_div_26_Template, 5, 2, \"div\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"aside\")(28, \"h2\");\n        i0.ɵɵtext(29, \"Cr\\u00E9er ou mettre \\u00E0 jour la collection\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(30, \"hr\");\n        i0.ɵɵelementStart(31, \"p\");\n        i0.ɵɵtext(32, \"Les donn\\u00E9es ci-dessous seront utilis\\u00E9es pour cr\\u00E9er ou mettre \\u00E0 jour la collection.\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"p\");\n        i0.ɵɵtext(34, \"Elles ont \\u00E9t\\u00E9 extraites des m\\u00E9dias scann\\u00E9s. Certaines sont modifiables mais la majorit\\u00E9 ne peut \\u00EAtre modif\\u00E9e qu'en mettant \\u00E0 jour les donn\\u00E9es dans les m\\u00E9dias scann\\u00E9s. Ils constituent le SET de r\\u00E9f\\u00E9rence permettant de garantir l'unit\\u00E9 des donn\\u00E9es.\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"form\", 4, 5);\n        i0.ɵɵlistener(\"ngSubmit\", function ScannerComponent_Template_form_ngSubmit_35_listener() {\n          return ctx.cloud.creeCollection();\n        });\n        i0.ɵɵtemplate(37, ScannerComponent_ul_37_Template, 9, 4, \"ul\", 6);\n        i0.ɵɵelementStart(38, \"label\", 7);\n        i0.ɵɵtext(39, \"Inidiquez des informations compl\\u00E9mentaires sur la collection\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"textarea\", 8);\n        i0.ɵɵlistener(\"ngModelChange\", function ScannerComponent_Template_textarea_ngModelChange_40_listener($event) {\n          return ctx.cloud.collection.description = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(41, \"label\", 9);\n        i0.ɵɵtext(42, \"Gestionnaire de la collection ?\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(43, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function ScannerComponent_Template_input_ngModelChange_43_listener($event) {\n          return ctx.cloud.collection.creator = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(44, \"button\", 11);\n        i0.ɵɵtext(45, \"Cr\\u00E9er la collection\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵtemplate(46, ScannerComponent_section_46_Template, 5, 0, \"section\", 12);\n      }\n\n      if (rf & 2) {\n        const _r3 = i0.ɵɵreference(36);\n\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.cloud.scanFolders);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind3(24, 8, ctx.cloud.scannedData, ctx.page.min, ctx.page.max));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.cloud.scannedData);\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngIf\", ctx.cloud.collection.title);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.cloud.collection.description);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.cloud.collection.creator);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", _r3.invalid);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.cloud.load);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i5.MatAccordion, i5.MatExpansionPanel, i5.MatExpansionPanelHeader, i5.MatExpansionPanelTitle, i6.MatProgressSpinner, i7.ɵNgNoValidate, i7.DefaultValueAccessor, i7.NgControlStatus, i7.NgControlStatusGroup, i7.NgModel, i7.NgForm, i4.SlicePipe, i4.KeyValuePipe],\n    styles: [\"section[_ngcontent-%COMP%] > aside[_ngcontent-%COMP%]:nth-child(1){flex:1;background-color:#6ebada}section[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{flex-direction:column;padding:0 10px}section[_ngcontent-%COMP%] > section[_ngcontent-%COMP%]{flex:2;background-color:#6ebada80}section[_ngcontent-%COMP%] > aside[_ngcontent-%COMP%]:nth-child(3){flex:3}section[_ngcontent-%COMP%] > aside[_ngcontent-%COMP%]:nth-child(3)   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}\"]\n  });\n  return ScannerComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}